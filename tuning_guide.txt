バランスロボット パラメータ調整ガイド
============================

使用可能なシリアルコマンド
-----------------------
status  - 現在のパラメータ値をすべて表示
kp      - 比例ゲインの設定 (例: kp 12.5)
ki      - 積分ゲインの設定 (例: ki 1.0)
kd      - 微分ゲインの設定 (例: kd 0.5)
ff      - レートフィードフォワードゲインの設定 (例: ff 0.8)
offset  - ピッチ軸のオフセット値設定 (例: offset -1.5)

シリアルモニタの表示内容
--------------------
P: ピッチ角（度）
R: ピッチレート（度/秒）
E: ピッチ角誤差
I: 積分項
M: モーター有効状態（ON/OFF）

初期パラメータ値
------------
Kp: 15.0 （比例ゲイン）
Ki: 1.0  （積分ゲイン）
Kd: 0.3  （微分ゲイン）
FF: 0.8  （フィードフォワードゲイン）
Offset: 0.0（ピッチオフセット）

調整手順
-------
1. ジャイロオフセットの調整
   - ロボットを可能な限り垂直に置く
   - シリアルモニタでピッチ角（P:の値）を確認
   - offsetコマンドで、測定された角度の逆符号の値を設定
   - 例：ピッチ角が+2.0度の場合 → offset -2.0 を設定

2. ハンチング（振動）の調整
   a) まずKdを上げて振動を抑制
      - 現在の値から20%ずつ増加（例：0.3 → 0.36 → 0.43）
      - 振動が収まるまで徐々に上げる
   
   b) 振動が続く場合はKpを下げる
      - 現在の値から20%ずつ減少（例：15.0 → 12.0 → 9.6）
      - システムの応答が遅くなるが、安定性が増す
   
   c) Ki値は小さめを維持
      - 大きすぎると振動の原因となる
      - 1.0以下を推奨

   d) システムが安定したら、徐々にKpを上げて応答性を改善
      - 10%ずつ増加させる
      - 振動が出始めたら一つ前の値に戻す

3. フィードフォワード（FF）の調整
   - 基本的に0.8付近で調整
   - 値を上げると外乱に対する反応が速くなる
   - 振動が出る場合は下げる

注意事項
-------
1. パラメータの変更は必ず少しずつ行う（10-20%程度）
2. 各パラメータ変更後は必ず数秒間動作を観察
3. 危険な振動が発生した場合はすぐにロボットの電源を切る
4. 良い値が見つかったら必ずメモを取る
5. statusコマンドで現在の値を確認してから調整を開始

トラブルシューティング
------------------
1. 急激な振動が発生
   - Kdを上げる
   - Kpを下げる

2. 応答が遅い
   - Kpを上げる
   - FFを上げる

3. 定常偏差が残る
   - Kiを少し上げる
   - オフセット値を再確認

4. 外乱に弱い
   - FFを上げる
   - Kpを上げる（振動しない範囲で）
